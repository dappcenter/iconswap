(this["webpackJsonpiconswap-ui"]=this["webpackJsonpiconswap-ui"]||[]).push([[0],{28:function(e,t,n){e.exports=n(41)},33:function(e,t,n){},34:function(e,t,n){},41:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(25),c=n.n(o),i=(n(33),n(4)),u=n(7),l=(n(34),n(1)),s=n.n(l),m=n(12),d=n.n(m),v=n(20),f=n(13),h=n(14),b=n(18),p=n(10),_=n(16),E=n(17),g=Object.freeze({LOCALHOST:Symbol("LOCALHOST"),MAINNET:Symbol("MAINNET"),EULJIRO:Symbol("EULJIRO"),YEOUIDO:Symbol("YEOUIDO")}),C=g.LOCALHOST,w="cx0000000000000000000000000000000000000000",I=(Object(E.a)(Error),function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(b.a)(this,Object(p.a)(t).call(this,e))).name="UnconfirmedTransaction",n}return Object(_.a)(t,e),Object(h.a)(t,[{key:"toString",value:function(){return"The transaction cannot be confirmed."}}]),t}(Object(E.a)(Error))),O=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(b.a)(this,Object(p.a)(t).call(this,e))).name="WrongEventSignature",n}return Object(_.a)(t,e),Object(h.a)(t,[{key:"toString",value:function(){return"The event received was not expected."}}]),t}(Object(E.a)(Error)),k=new(function(){function e(t,n){Object(f.a)(this,e);var a=this._getNetworkInfo(t),r=a.url,o=new s.a.HttpProvider(r+"/api/v3"),c=new s.a.HttpProvider(r+"/api/debug/v3");this._nid=a.nid,this._network=t,this._iconService=new s.a(o),this._iconDebugService=new s.a(c),this._scoreAddress=n}return Object(h.a)(e,[{key:"_getNetworkInfo",value:function(e){var t=[];return t[g.LOCALHOST]={url:"http://127.0.0.1:9000",nid:0},t[g.MAINNET]={url:"https://ctz.solidwallet.io",nid:1},t[g.EULJIRO]={url:"https://test-ctz.solidwallet.io",nid:2},t[g.YEOUIDO]={url:"https://bicon.net.solidwallet.io",nid:3},t[e]}},{key:"getEndpoint",value:function(){return this._getNetworkInfo(g.MAINNET).url}},{key:"getWhitelist",value:function(){return this.__call(this._scoreAddress,"get_whitelist").then((function(e){return e}))}},{key:"getSwap",value:function(e){return k.__call(this._scoreAddress,"get_swap",{swapid:e}).then((function(e){return e}))}},{key:"getOrder",value:function(e){return k.__call(this._scoreAddress,"get_order",{orderid:e}).then((function(e){return e}))}},{key:"getDecimals",value:function(e){return e===w?new Promise((function(e,t){e(18)})):k.__call(e,"decimals").then((function(e){return e}))}},{key:"fulfillIcxOrder",value:function(e,t){var n=s.a.IconConverter.toHex(t.amount);return k.__iconexCallTransaction(e,this._scoreAddress,"fulfill_icx_order",n,{orderid:t.id}).then((function(e){return e}))}},{key:"fulfillIRC2Order",value:function(e,t){var n=s.a.IconConverter.toHex(t.amount);return k.__iconexCallTransaction(e,t.contract,"transfer",0,{_to:this._scoreAddress,_value:n,_data:s.a.IconConverter.toHex(t.id)}).then((function(e){return e}))}},{key:"doSwap",value:function(e,t){return k.__iconexCallTransaction(e,this._scoreAddress,"do_swap",0,{swapid:t}).then((function(e){return e}))}},{key:"cancelSwap",value:function(e,t){return k.__iconexCallTransaction(e,this._scoreAddress,"cancel_swap",0,{swapid:t}).then((function(e){return e}))}},{key:"createSwap",value:function(e,t,n,a,r){var o=this,c={contract1:t,amount1:s.a.IconConverter.toHex(s.a.IconConverter.toBigNumber(n)),contract2:a,amount2:s.a.IconConverter.toHex(s.a.IconConverter.toBigNumber(r))};return this.__iconexCallTransaction(e,this._scoreAddress,"create_swap",0,c).then(function(){var e=Object(v.a)(d.a.mark((function e(t){var n,a,r,c,i,u;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.result,e.next=3,o.__txResult(n);case 3:if(a=e.sent,"SwapCreatedEvent(int,int,int)"===(r=a.eventLogs[0]).indexed[0]){e.next=7;break}throw O(r.indexed);case 7:return console.log(a),c=parseInt(r.indexed[1],16),i=parseInt(r.data[0],16),u=parseInt(r.data[1],16),e.abrupt("return",{swapId:c,order1:i,order2:u});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"tokenName",value:function(e){return this.__call(e,"name").then((function(e){return e}))}},{key:"tokenSymbol",value:function(e){return this.__call(e,"symbol").then((function(e){return e}))}},{key:"iconexHasAccount",value:function(){return this.__iconexConnectRequest("REQUEST_HAS_ACCOUNT").then((function(e){return e}))}},{key:"iconexHasAddress",value:function(e){return this.__iconexConnectRequest("REQUEST_HAS_ADDRESS",e).then((function(e){return e}))}},{key:"iconexAskAddress",value:function(){return this.__iconexConnectRequest("REQUEST_ADDRESS").then((function(e){return e}))}},{key:"__iconexCallTransactionEx",value:function(e,t,n,a,r,o){var c=this.__icxCallTransactionBuild(e,t,n,a,r,o),i={jsonrpc:"2.0",method:"icx_sendTransaction",params:s.a.IconConverter.toRawTransaction(c),id:1234};return this.__iconexJsonRpc(i)}},{key:"__iconexCallTransaction",value:function(e,t,n,a,r){return k.__estimateCallStep(e,t,n,a,r).then((function(o){return k.__iconexCallTransactionEx(e,t,n,a,o,r)}))}},{key:"__iconexConnectRequest",value:function(e,t){return new Promise((function(n,a){window.addEventListener("ICONEX_RELAY_RESPONSE",(function e(t){var a=t.detail.payload;window.removeEventListener("ICONEX_RELAY_RESPONSE",e),n(a)})),window.dispatchEvent(new window.CustomEvent("ICONEX_RELAY_REQUEST",{detail:{type:e,payload:t}}))}))}},{key:"__iconexJsonRpc",value:function(e){return this.__iconexConnectRequest("REQUEST_JSON-RPC",e).then((function(e){return e}))}},{key:"__call",value:function(e,t){var n=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise((function(r,o){try{var c=(new s.a.IconBuilder.CallBuilder).from(null).to(e).method(t);0!==Object.keys(a).length&&(c=c.params(a));var i=c.build();r(n._iconService.call(i).execute())}catch(u){o(u)}}))}},{key:"__callTx",value:function(e,t,n,a){var r=this,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};return new Promise((function(i,u){try{var l=(new s.a.IconBuilder.CallTransactionBuilder).from(n.getAddress()).to(e).value(s.a.IconConverter.toHex(s.a.IconAmount.of(o,s.a.IconAmount.Unit.ICX).toLoop())).stepLimit(s.a.IconConverter.toBigNumber(a)).nid(s.a.IconConverter.toBigNumber(r._nid)).nonce(s.a.IconConverter.toBigNumber(1)).version(s.a.IconConverter.toBigNumber(3)).timestamp(1e3*(new Date).getTime()).method(t);0!==Object.keys(c).length&&(l=l.params(c));var m=new s.a.SignedTransaction(l.build(),n);i(r._iconService.sendTransaction(m).execute())}catch(d){u(d)}}))}},{key:"__estimateCallStep",value:function(e,t,n,a){var r=this,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},c={jsonrpc:"2.0",method:"debug_estimateStep",id:1,params:{version:"0x3",from:e,to:t,value:s.a.IconConverter.toHex(s.a.IconConverter.toBigNumber(a)),timestamp:s.a.IconConverter.toHex(1e3*(new Date).getTime()),nid:s.a.IconConverter.toHex(s.a.IconConverter.toBigNumber(this._nid)),nonce:"0x1",dataType:"call",data:{method:n,params:o}}};return new Promise((function(e,t){try{e(r._iconDebugService.provider.request(c).execute())}catch(n){t(n)}}))}},{key:"__icxCallTransactionBuild",value:function(e,t,n,a,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},c=(new s.a.IconBuilder.CallTransactionBuilder).from(e).to(t).value(s.a.IconConverter.toHex(a)).stepLimit(s.a.IconConverter.toBigNumber(r)).nid(s.a.IconConverter.toBigNumber(this._nid)).nonce(s.a.IconConverter.toBigNumber(1)).version(s.a.IconConverter.toBigNumber(3)).timestamp(1e3*(new Date).getTime()).method(n);return 0!==Object.keys(o).length&&(c=c.params(o)),c.build()}},{key:"__icxTransactionBuild",value:function(e,t,n,a){return(new s.a.IconBuilder.IcxTransactionBuilder).from(e).to(t).value(s.a.IconConverter.toBigNumber(n)).stepLimit(s.a.IconConverter.toBigNumber(a)).nid(s.a.IconConverter.toBigNumber(this._nid)).version(s.a.IconConverter.toBigNumber(3)).timestamp(1e3*(new Date).getTime()).build()}},{key:"__txResult",value:function(){var e=Object(v.a)(d.a.mark((function e(t){var n,a,r=arguments;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:1e3,a=r.length>2&&void 0!==r[2]?r[2]:100,e.prev=2,e.next=5,this._iconService.getTransactionResult(t).execute();case 5:return e.abrupt("return",e.sent);case 8:if(e.prev=8,e.t0=e.catch(2),!n){e.next=16;break}return e.next=13,new Promise((function(e,t){return setTimeout(e,a)}));case 13:return e.abrupt("return",this.__txResult(t,n-1,a));case 16:throw new I(t);case 17:case"end":return e.stop()}}),e,this,[[2,8]])})));return function(t){return e.apply(this,arguments)}}()}]),e}())(C,"cx17b53a38661427590e0e5022e0d452a9f7fc4432"),x=function(e){return e===w?new Promise((function(t,n){t({name:"ICX",symbol:"ICX",contract:e,decimals:18})})):k.tokenName(e).then((function(t){return k.tokenSymbol(e).then((function(n){return k.getDecimals(e).then((function(a){return{name:t,symbol:n,contract:e,decimals:parseInt(a,16)}}))}))}))},y=function(e){var t=e.match,n=e.wallet,o=t.params.id,c=Object(a.useState)(null),u=Object(i.a)(c,2),s=u[0],m=u[1],d=Object(a.useState)(null),v=Object(i.a)(d,2),f=v[0],h=v[1],b=Object(a.useState)(!1),p=Object(i.a)(b,2),_=p[0],E=p[1];Object(a.useEffect)((function(){var e=function(){return k.getSwap(o).then((function(e){var t,n;t=e.order1,n=e.order2,k.getOrder(t).then((function(e){x(e.contract).then((function(a){e.token=a,e.id=t,k.getOrder(n).then((function(t){x(t.contract).then((function(a){t.token=a,t.id=n,m([e,t])}))}))}))})),h(e),!_&&E(!0)}))};e(),_&&setInterval((function(){e()}),1e3)}),[_,o]);var g=function(e){e.contract===w?k.fulfillIcxOrder(n,e):k.fulfillIRC2Order(n,e)},C=function(e){return"EMPTY"!==e.status};return r.a.createElement(r.a.Fragment,null,f&&"SUCCESS"===f.status&&r.a.createElement("div",{className:"overlay"},r.a.createElement("div",{className:"overlayText"},"Swap successfull! ",r.a.createElement("br",null),r.a.createElement("a",{href:"https://tracker.icon.foundation/transaction/"+f.transaction},"Check the transaction"))),f&&"CANCELLED"===f.status&&r.a.createElement("div",{className:"overlay"},r.a.createElement("div",{className:"overlayText"},"Swap cancelled. Your funds have been refunded. ",r.a.createElement("br",null),r.a.createElement("a",{href:"https://tracker.icon.foundation/transaction/"+f.transaction},"Check the transaction"))),s&&r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"split left"},r.a.createElement("div",{className:"centered"},r.a.createElement("p",{className:"bigtext"},l.IconConverter.toBigNumber(s[0].amount)/l.IconConverter.toBigNumber("10").exponentiatedBy(s[0].token.decimals)," ",s[0].token.symbol," (",s[0].token.name,")"),r.a.createElement("button",{className:"bigbutton",disabled:C(s[0]),onClick:function(){g(s[0])}},"Deposit"))),r.a.createElement("div",{className:"split right"},r.a.createElement("div",{className:"centered"},r.a.createElement("p",{className:"bigtext"},l.IconConverter.toBigNumber(s[1].amount)/l.IconConverter.toBigNumber("10").exponentiatedBy(s[1].token.decimals)," ",s[1].token.symbol," (",s[1].token.name,")"),r.a.createElement("button",{className:"bigbutton",disabled:C(s[1]),onClick:function(){g(s[1])}},"Deposit"))),r.a.createElement("div",{className:"center"},r.a.createElement("button",{className:"bigbutton",disabled:!(s&&"FILLED"===s[0].status&&"FILLED"===s[1].status),onClick:function(){k.doSwap(n,o)}},"Swap!")),f&&f.author===n&&r.a.createElement("div",{className:"bottom"},r.a.createElement("button",{className:"bigbutton",disabled:!(f&&"PENDING"===f.status),onClick:function(){k.cancelSwap(n,o)}},"Cancel Swap"))))},N=function(e){var t=e.wallet,n=Object(a.useState)(null),o=Object(i.a)(n,2),c=o[0],s=o[1],m=Object(a.useState)(null),d=Object(i.a)(m,2),v=d[0],f=d[1],h=Object(a.useState)(12),b=Object(i.a)(h,2),p=b[0],_=b[1],E=Object(a.useState)(null),g=Object(i.a)(E,2),C=g[0],w=g[1],I=Object(a.useState)(34),O=Object(i.a)(I,2),y=O[0],N=O[1],S=Object(a.useState)(null),j=Object(i.a)(S,2),T=j[0],B=j[1];!c&&k.getWhitelist().then((function(e){var t=e.map((function(e){return x(e)}));Promise.all(t).then((function(e){f(e[0]),w(e[0]),e=e.reduce((function(e,t){return e[t.contract]=t,e}),{}),s(e)}))}));return r.a.createElement(r.a.Fragment,null,T&&r.a.createElement(u.a,{to:"/swap/"+T}),r.a.createElement("div",{className:"split left"},r.a.createElement("div",{className:"centered"},c&&r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"Choose a token :"),r.a.createElement("select",{id:"tokens1",onChange:function(){return f(c[document.getElementById("tokens1").value])}},Object.keys(c).map((function(e){return r.a.createElement("option",{key:c[e].contract,value:c[e].contract},c[e].name," (",c[e].symbol,")")}))),r.a.createElement("p",null,"Choose the amount :"),r.a.createElement("input",{id:"amount1",onChange:function(){return _(document.getElementById("amount1").value)}})))),r.a.createElement("div",{className:"split right"},r.a.createElement("div",{className:"centered"},c&&r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"Choose a token :"),r.a.createElement("select",{id:"tokens2",onChange:function(){return w(c[document.getElementById("tokens2").value])}},Object.keys(c).map((function(e){return r.a.createElement("option",{key:c[e].contract,value:c[e].contract},c[e].name," (",c[e].symbol,")")}))),r.a.createElement("p",null,"Choose the amount :"),r.a.createElement("input",{id:"amount2",onChange:function(){return N(document.getElementById("amount2").value)}})))),v&&C&&p&&y&&r.a.createElement("div",{className:"center"},r.a.createElement("button",{className:"bigbutton",onClick:function(){k.getDecimals(v.contract).then((function(e){k.getDecimals(C.contract).then((function(n){var a=l.IconConverter.toBigNumber("10").exponentiatedBy(e),r=l.IconConverter.toBigNumber("10").exponentiatedBy(n);k.createSwap(t,v.contract,p*a,C.contract,y*r).then((function(e){B(e.swapId)}))}))}))}},"Create Swap")))};var S=function(){var e=Object(a.useState)("hxba2e54b54b695085f31ff1a9b33868b5aea44e33"),t=Object(i.a)(e,2),n=t[0],o=t[1];return r.a.createElement("div",{className:"App"},!n&&r.a.createElement("button",{className:"bigbutton center",onClick:function(){k.iconexAskAddress().then((function(e){o(e)}))}},"Login with ICONex"),n&&r.a.createElement(u.d,null,r.a.createElement(u.b,{exact:!0,path:"/",render:function(e){return r.a.createElement(N,Object.assign({},e,{wallet:n}))}}),r.a.createElement(u.b,{exact:!0,path:"/swap/:id",render:function(e){return r.a.createElement(y,Object.assign({},e,{wallet:n}))}})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var j=n(15);c.a.render(r.a.createElement(j.a,null,r.a.createElement(S,null)),document.querySelector("#root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[28,1,2]]]);
//# sourceMappingURL=main.1c5cfeb0.chunk.js.map