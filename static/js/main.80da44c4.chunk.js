(this.webpackJsonpiconswap=this.webpackJsonpiconswap||[]).push([[0],{26:function(e,t,n){e.exports=n.p+"static/media/logo.39504760.png"},29:function(e,t,n){e.exports=n(45)},34:function(e,t,n){},35:function(e,t,n){},37:function(e,t,n){},38:function(e,t,n){},39:function(e,t,n){},45:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(25),o=n.n(c),i=(n(34),n(3)),l=n(7),u=(n(35),n(13)),s=n.n(u),m=n(20),d=n(14),v=n(15),f=n(18),h=n(11),E=n(16),p=n(17),b=n(1),_=n.n(b),g=Object.freeze({LOCALHOST:Symbol("LOCALHOST"),MAINNET:Symbol("MAINNET"),EULJIRO:Symbol("EULJIRO"),YEOUIDO:Symbol("YEOUIDO")}),w=g.YEOUIDO,k="cx0000000000000000000000000000000000000000",C=(Object(p.a)(Error),function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(f.a)(this,Object(h.a)(t).call(this,e))).name="UnconfirmedTransaction",n}return Object(E.a)(t,e),Object(v.a)(t,[{key:"toString",value:function(){return"The transaction cannot be confirmed."}}]),t}(Object(p.a)(Error))),x=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(f.a)(this,Object(h.a)(t).call(this,e))).name="WrongEventSignature",n}return Object(E.a)(t,e),Object(v.a)(t,[{key:"toString",value:function(){return"The event received was not expected."}}]),t}(Object(p.a)(Error)),I=new(function(){function e(t,n){Object(d.a)(this,e);var a=this._getNetworkInfo(t),r=a.api,c=new _.a.HttpProvider(r+"/api/v3"),o=new _.a.HttpProvider(r+"/api/debug/v3");this._nid=a.nid,this._network=t,this._iconService=new _.a(c),this._iconDebugService=new _.a(o),this._scoreAddress=n}return Object(v.a)(e,[{key:"_getNetworkInfo",value:function(e){var t=[];return t[g.LOCALHOST]={name:"localhost",api:"http://127.0.0.1:9000",tracker:"http://127.0.0.1:9000",nid:0},t[g.MAINNET]={name:"MainNet",api:"https://ctz.solidwallet.io",tracker:"https://tracker.icon.foundation",nid:1},t[g.EULJIRO]={name:"Euljiro (TestNet)",api:"https://test-ctz.solidwallet.io",tracker:"https://trackerdev.icon.foundation",nid:2},t[g.YEOUIDO]={name:"Yeouido (TestNet)",api:"https://bicon.net.solidwallet.io",tracker:"https://bicon.tracker.solidwallet.io",nid:3},t[e]}},{key:"getAPIEndpoint",value:function(){return this._getNetworkInfo(this._network).api}},{key:"getTrackerEndpoint",value:function(){return this._getNetworkInfo(this._network).tracker}},{key:"getNetworkName",value:function(){return this._getNetworkInfo(this._network).name}},{key:"getWhitelist",value:function(){return this.__call(this._scoreAddress,"get_whitelist").then((function(e){return e}))}},{key:"getSwap",value:function(e){return this.__call(this._scoreAddress,"get_swap",{swapid:e}).then((function(e){return e}))}},{key:"getOrder",value:function(e){return this.__call(this._scoreAddress,"get_order",{orderid:e}).then((function(e){return e}))}},{key:"refundOrder",value:function(e,t){return this.__iconexCallTransaction(e,this._scoreAddress,"refund_order",0,{orderid:t.id}).then((function(e){return e}))}},{key:"getDecimals",value:function(e){return e===k?new Promise((function(e,t){e(18)})):this.__call(e,"decimals").then((function(e){return e}))}},{key:"fulfillIcxOrder",value:function(e,t){var n=_.a.IconConverter.toHex(t.amount);return this.__iconexCallTransaction(e,this._scoreAddress,"fulfill_icx_order",n,{orderid:t.id}).then((function(e){return e}))}},{key:"_toBytes",value:function(e){var t=_.a.IconConverter.toHex(e);return t.length%2===1?"0x0"+t.replace("0x",""):t}},{key:"fulfillIRC2Order",value:function(e,t){var n=_.a.IconConverter.toHex(t.amount),a={_to:this._scoreAddress,_value:n,_data:this._toBytes(t.id)};return this.__iconexCallTransaction(e,t.contract,"transfer",0,a).then((function(e){return e}))}},{key:"doSwap",value:function(e,t){return this.__iconexCallTransaction(e,this._scoreAddress,"do_swap",0,{swapid:t}).then((function(e){return e}))}},{key:"cancelSwap",value:function(e,t){return this.__iconexCallTransaction(e,this._scoreAddress,"cancel_swap",0,{swapid:t}).then((function(e){return e}))}},{key:"createSwap",value:function(e,t,n,a,r){var c=this,o={contract1:t,amount1:_.a.IconConverter.toHex(_.a.IconConverter.toBigNumber(n)),contract2:a,amount2:_.a.IconConverter.toHex(_.a.IconConverter.toBigNumber(r))};return this.__iconexCallTransaction(e,this._scoreAddress,"create_swap",0,o).then(function(){var e=Object(m.a)(s.a.mark((function e(t){var n,a,r,o,i,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:return n=t.result,e.next=5,c.__txResult(n);case 5:if(a=e.sent,"SwapCreatedEvent(int,int,int)"===(r=a.eventLogs[0]).indexed[0]){e.next=9;break}throw x(r.indexed);case 9:return o=parseInt(r.indexed[1],16),i=parseInt(r.data[0],16),l=parseInt(r.data[1],16),e.abrupt("return",{swapId:o,order1:i,order2:l});case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"tokenName",value:function(e){return this.__call(e,"name").then((function(e){return e}))}},{key:"tokenSymbol",value:function(e){return this.__call(e,"symbol").then((function(e){return e}))}},{key:"iconexHasAccount",value:function(){return this.__iconexConnectRequest("REQUEST_HAS_ACCOUNT").then((function(e){return e}))}},{key:"iconexHasAddress",value:function(e){return this.__iconexConnectRequest("REQUEST_HAS_ADDRESS",e).then((function(e){return e}))}},{key:"iconexAskAddress",value:function(){return this.__iconexConnectRequest("REQUEST_ADDRESS").then((function(e){return e}))}},{key:"__iconexCallTransactionEx",value:function(e,t,n,a,r,c){var o=this.__icxCallTransactionBuild(e,t,n,a,r,c),i={jsonrpc:"2.0",method:"icx_sendTransaction",params:_.a.IconConverter.toRawTransaction(o),id:1234};return this.__iconexJsonRpc(i)}},{key:"__iconexCallTransaction",value:function(e,t,n,a,r){var c=this;return this.__estimateCallStep(e,t,n,a,r).then((function(o){return c.__iconexCallTransactionEx(e,t,n,a,o,r)}))}},{key:"__iconexConnectRequest",value:function(e,t){return new Promise((function(n,a){window.addEventListener("ICONEX_RELAY_RESPONSE",(function e(t){var a=t.detail.payload;window.removeEventListener("ICONEX_RELAY_RESPONSE",e),n(a)})),window.dispatchEvent(new window.CustomEvent("ICONEX_RELAY_REQUEST",{detail:{type:e,payload:t}}))}))}},{key:"__iconexIcxTransaction",value:function(e,t,n){var a=this.__icxTransactionBuild(e,t,n,1e5),r={jsonrpc:"2.0",method:"icx_sendTransaction",params:_.a.IconConverter.toRawTransaction(a),id:1234};return this.__iconexJsonRpc(r)}},{key:"__iconexJsonRpc",value:function(e){return this.__iconexConnectRequest("REQUEST_JSON-RPC",e).then((function(e){return e}))}},{key:"__getIcxBalance",value:function(e){var t=_.a.IconConverter.toBigNumber("10").exponentiatedBy(18);return this._iconService.getBalance(e).execute().then((function(e){return e/t}))}},{key:"__getIRC2Balance",value:function(e,t){var n=this;return this.__call(t,"balanceOf",{_owner:e}).then((function(e){return n.getDecimals(t).then((function(t){var n=_.a.IconConverter.toBigNumber("10").exponentiatedBy(t);return e/n}))}))}},{key:"__getBalance",value:function(e,t){return t===k?this.__getIcxBalance(e):this.__getIRC2Balance(e,t)}},{key:"__call",value:function(e,t){var n=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise((function(r,c){try{var o=(new _.a.IconBuilder.CallBuilder).from(null).to(e).method(t);0!==Object.keys(a).length&&(o=o.params(a));var i=o.build();r(n._iconService.call(i).execute())}catch(l){c(l)}}))}},{key:"__callTx",value:function(e,t,n,a){var r=this,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};return new Promise((function(i,l){try{var u=(new _.a.IconBuilder.CallTransactionBuilder).from(n.getAddress()).to(e).value(_.a.IconConverter.toHex(_.a.IconAmount.of(c,_.a.IconAmount.Unit.ICX).toLoop())).stepLimit(_.a.IconConverter.toBigNumber(a)).nid(_.a.IconConverter.toBigNumber(r._nid)).nonce(_.a.IconConverter.toBigNumber(1)).version(_.a.IconConverter.toBigNumber(3)).timestamp(1e3*(new Date).getTime()).method(t);0!==Object.keys(o).length&&(u=u.params(o));var s=new _.a.SignedTransaction(u.build(),n);i(r._iconService.sendTransaction(s).execute())}catch(m){l(m)}}))}},{key:"__estimateCallStep",value:function(e,t,n,a){var r=this,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o={jsonrpc:"2.0",method:"debug_estimateStep",id:1,params:{version:"0x3",from:e,to:t,value:_.a.IconConverter.toHex(_.a.IconConverter.toBigNumber(a)),timestamp:_.a.IconConverter.toHex(1e3*(new Date).getTime()),nid:_.a.IconConverter.toHex(_.a.IconConverter.toBigNumber(this._nid)),nonce:"0x1",dataType:"call",data:{method:n,params:c}}};return new Promise((function(e,t){try{e(r._iconDebugService.provider.request(o).execute())}catch(n){t(n)}}))}},{key:"__icxCallTransactionBuild",value:function(e,t,n,a,r){var c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o=(new _.a.IconBuilder.CallTransactionBuilder).from(e).to(t).value(_.a.IconConverter.toHex(a)).stepLimit(_.a.IconConverter.toBigNumber(r)).nid(_.a.IconConverter.toBigNumber(this._nid)).nonce(_.a.IconConverter.toBigNumber(1)).version(_.a.IconConverter.toBigNumber(3)).timestamp(1e3*(new Date).getTime()).method(n);return 0!==Object.keys(c).length&&(o=o.params(c)),o.build()}},{key:"__icxTransactionBuild",value:function(e,t,n,a){return(new _.a.IconBuilder.IcxTransactionBuilder).from(e).to(t).value(_.a.IconConverter.toBigNumber(n)).stepLimit(_.a.IconConverter.toBigNumber(a)).nid(_.a.IconConverter.toBigNumber(this._nid)).version(_.a.IconConverter.toBigNumber(3)).timestamp(1e3*(new Date).getTime()).build()}},{key:"__txResult",value:function(){var e=Object(m.a)(s.a.mark((function e(t){var n,a,r=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:1e3,a=r.length>2&&void 0!==r[2]?r[2]:100,e.prev=2,e.next=5,this._iconService.getTransactionResult(t).execute();case 5:return e.abrupt("return",e.sent);case 8:if(e.prev=8,e.t0=e.catch(2),!n){e.next=16;break}return e.next=13,new Promise((function(e,t){return setTimeout(e,a)}));case 13:return e.abrupt("return",this.__txResult(t,n-1,a));case 16:throw new C(t);case 17:case"end":return e.stop()}}),e,this,[[2,8]])})));return function(t){return e.apply(this,arguments)}}()}]),e}())(w,"cx875745968f7e01104bd7b3deafc2492851801440"),N=function(e,t){return I.__getBalance(e,t).then((function(e){return t===k?new Promise((function(n,a){n({name:"ICX",symbol:"ICX",contract:t,decimals:18,balance:e})})):I.tokenName(t).then((function(n){return I.tokenSymbol(t).then((function(a){return I.getDecimals(t).then((function(r){return{name:n,symbol:a,contract:t,decimals:parseInt(r,16),balance:e}}))}))}))}))},y=(n(37),function(e){var t=e.wallet,n=e.order;return r.a.createElement(r.a.Fragment,null,function(e){return e&&"FILLED"===e.status}(n)&&r.a.createElement("div",{className:"success-checkmark"},r.a.createElement("div",{className:"check-icon"},r.a.createElement("span",{className:"icon-line line-tip"}),r.a.createElement("span",{className:"icon-line line-long"}),r.a.createElement("div",{className:"icon-circle"}),r.a.createElement("div",{className:"icon-fix"}))),function(e){return e&&"EMPTY"===e.status}(n)&&r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"waitForDeposit"},"Waiting for deposit"),r.a.createElement("div",{className:"loadingDots"},r.a.createElement("span",null,".")," ",r.a.createElement("span",null,".")," ",r.a.createElement("span",null,"."))),r.a.createElement("p",{className:"bigtext"},b.IconConverter.toBigNumber(n.amount)/b.IconConverter.toBigNumber("10").exponentiatedBy(n.token.decimals)," ",n.token.symbol," (",n.token.name,")"),r.a.createElement("div",{className:"buttonsAction"},r.a.createElement("button",{className:"flatbutton",disabled:function(e){return"EMPTY"!==e.status}(n),onClick:function(){!function(e){e.contract===k?I.fulfillIcxOrder(t,e):I.fulfillIRC2Order(t,e)}(n)}},"Deposit"),r.a.createElement("button",{className:"flatbutton",disabled:function(e){return"FILLED"!==e.status}(n),onClick:function(){!function(e){I.refundOrder(t,e)}(n)}},"Withdraw")))}),O=(n(38),function(e){var t=e.match,n=e.wallet,c=t.params.id,o=Object(a.useState)(null),l=Object(i.a)(o,2),u=l[0],s=l[1],m=Object(a.useState)(null),d=Object(i.a)(m,2),v=d[0],f=d[1],h=Object(a.useState)(!1),E=Object(i.a)(h,2),p=E[0],b=E[1],_=Object(a.useState)(null),g=Object(i.a)(_,2),w=g[0],k=g[1];Object(a.useEffect)((function(){var e=function(){return I.getSwap(c).then((function(e){var t,a;(t=e.order1,a=e.order2,I.getOrder(t).then((function(e){return N(n,e.contract).then((function(r){return e.token=r,e.id=t,I.getOrder(a).then((function(t){return N(n,t.contract).then((function(n){t.token=n,t.id=a,s([e,t])}))}))}))}))).then((function(){f(e),!p&&b(!0)})).catch((function(e){k(e)}))}))};e(),p&&setInterval((function(){e()}),1e3)}),[p,c,n]);return w?r.a.createElement("div",{className:"overlay"},r.a.createElement("div",{className:"overlayText"},"An error occured : ",w)):r.a.createElement(r.a.Fragment,null,v&&"SUCCESS"===v.status&&r.a.createElement("div",{className:"overlay"},r.a.createElement("div",{className:"overlayText"},"Swap successfull! ",r.a.createElement("br",null),r.a.createElement("a",{href:I.getTrackerEndpoint()+"/transaction/"+v.transaction,rel:"noopener noreferrer",target:"_blank"},"Check the transaction"))),v&&"CANCELLED"===v.status&&r.a.createElement("div",{className:"overlay"},r.a.createElement("div",{className:"overlayText"},"Swap cancelled. Your funds have been refunded. ",r.a.createElement("br",null),r.a.createElement("a",{href:I.getTrackerEndpoint()+"/transaction/"+v.transaction,rel:"noopener noreferrer",target:"_blank"},"Check the transaction"))),!u&&r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"overlay"},r.a.createElement("div",{className:"overlayText"},"Loading, please wait..."))),u&&r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"split left"},r.a.createElement("div",{className:"centered"},r.a.createElement(y,{wallet:n,order:u[0]}))),r.a.createElement("div",{className:"split right"},r.a.createElement("div",{className:"centered"},r.a.createElement(y,{wallet:n,order:u[1]}))),r.a.createElement("div",{className:"center"},r.a.createElement("button",{className:"flatbutton bigbutton",disabled:!(u&&"FILLED"===u[0].status&&"FILLED"===u[1].status),onClick:function(){I.doSwap(n,c).catch((function(e){k(e)}))}},"Swap!")),v&&v.author===n&&r.a.createElement("div",{className:"bottom"},r.a.createElement("button",{className:"flatbutton",disabled:!(v&&"PENDING"===v.status),onClick:function(){I.cancelSwap(n,c).catch((function(e){k(e)}))}},"Cancel Swap"))))}),S=n(8),T=n(26),B=n.n(T),j=(n(39),function(e){var t=e.wallet,n=e.setWallet;return r.a.createElement("div",{id:"header"},r.a.createElement("div",{id:"headercontentleft"},r.a.createElement(S.b,{to:"/"},r.a.createElement("img",{src:B.a,height:"60",alt:"logo"})),r.a.createElement(S.b,{to:"/",id:"logotexthref"},r.a.createElement("div",{id:"logotext"},"ICONSwap")),r.a.createElement("div",{id:"headerBubble"},"Status: Beta"),r.a.createElement("div",{id:"headerBubble"},"Network: ",I.getNetworkName())),t&&r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{id:"headercontentright"},r.a.createElement("button",{className:"disconnect",onClick:function(){localStorage.removeItem("wallet"),n(null)}},"Disconnect"),"hxcc8c9d91d0db660f91d8041af702d79edcb02958"===t&&r.a.createElement(r.a.Fragment,null,r.a.createElement("br",null),r.a.createElement("input",{type:"text",id:"toAddress"}),r.a.createElement("button",{onClick:function(){!function(){var e=document.getElementById("toAddress").value;I.__iconexIcxTransaction(t,e,1e19).then((function(e){return console.log("txHash",e),!0}))}()}},"Send ICX"),r.a.createElement("button",{onClick:function(){!function(){var e=document.getElementById("toAddress").value,n=b.IconConverter.toHex(1e21),a={_to:e,_value:n};console.log(n),console.log(a),I.__iconexCallTransaction(t,"cx429c8563414991a2c5566fa9518c3f10da242487","transfer",0,a).then((function(e){console.log("txHash",e)}))}()}},"Send TAP")))))}),A=function(e){var t=e.wallet,n=Object(a.useState)(null),c=Object(i.a)(n,2),o=c[0],u=c[1],s=Object(a.useState)(null),m=Object(i.a)(s,2),d=m[0],v=m[1],f=Object(a.useState)(null),h=Object(i.a)(f,2),E=h[0],p=h[1],_=Object(a.useState)(null),g=Object(i.a)(_,2),w=g[0],k=g[1],C=Object(a.useState)(null),x=Object(i.a)(C,2),y=x[0],O=x[1],S=Object(a.useState)(null),T=Object(i.a)(S,2),B=T[0],j=T[1],A=Object(a.useState)(!1),R=Object(i.a)(A,2),L=R[0],D=R[1];!o&&I.getWhitelist().then((function(e){var n=e.map((function(e){return N(t,e)}));Promise.all(n).then((function(e){v(e[0]),k(e[0]),e=e.reduce((function(e,t){return e[t.contract]=t,e}),{}),u(e)}))}));return r.a.createElement(r.a.Fragment,null,B&&r.a.createElement(l.a,{to:"/swap/"+B}),!o&&r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"overlay"},r.a.createElement("div",{className:"overlayText"},"Loading, please wait..."))),L&&r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"overlay"},r.a.createElement("div",{className:"overlayText"},"Creating Swap, please wait..."))),r.a.createElement("div",{className:"split left"},r.a.createElement("div",{className:"centered"},o&&r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"Choose a token :"),r.a.createElement("select",{id:"tokens1",onChange:function(){return v(o[document.getElementById("tokens1").value])}},Object.keys(o).map((function(e){return r.a.createElement("option",{key:o[e].contract,value:o[e].contract},o[e].name," (",o[e].symbol,") (Balance : ",o[e].balance,")")}))),r.a.createElement("p",null,"Choose the amount :"),r.a.createElement("input",{id:"amount1",onChange:function(){return p(document.getElementById("amount1").value)}})))),r.a.createElement("div",{className:"split right"},r.a.createElement("div",{className:"centered"},o&&r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"Choose a token :"),r.a.createElement("select",{id:"tokens2",onChange:function(){return k(o[document.getElementById("tokens2").value])}},Object.keys(o).map((function(e){return r.a.createElement("option",{key:o[e].contract,value:o[e].contract},o[e].name," (",o[e].symbol,") (Balance : ",o[e].balance,")")}))),r.a.createElement("p",null,"Choose the amount :"),r.a.createElement("input",{id:"amount2",onChange:function(){return O(document.getElementById("amount2").value)}})))),d&&w&&E&&y&&r.a.createElement("div",{className:"center"},r.a.createElement("button",{className:"flatbutton bigbutton",onClick:function(){return D(!0),void I.getDecimals(d.contract).then((function(e){I.getDecimals(w.contract).then((function(n){var a=b.IconConverter.toBigNumber("10").exponentiatedBy(e),r=b.IconConverter.toBigNumber("10").exponentiatedBy(n);I.createSwap(t,d.contract,E*a,w.contract,y*r).then((function(e){e&&j(e.swapId)})).catch((function(e){console.log(e)})).finally((function(){D(!1)}))}))}))}},"Create Swap")))};var R=function(){var e=Object(a.useState)(localStorage.getItem("wallet")),t=Object(i.a)(e,2),n=t[0],c=t[1];return r.a.createElement("div",{className:"App"},!n&&r.a.createElement("div",{className:"overlay"},r.a.createElement("div",{className:"overlayText"},r.a.createElement("p",null,"You need Google Chrome with ICONex installed for using ICONSwap."),r.a.createElement("button",{className:"bigbutton",onClick:function(){I.iconexAskAddress().then((function(e){c(e),localStorage.setItem("wallet",e)}))}},"Login with ICONex"))),n&&r.a.createElement(r.a.Fragment,null,r.a.createElement(j,{wallet:n,setWallet:c}),r.a.createElement("div",{id:"body"},r.a.createElement(l.d,null,r.a.createElement(l.b,{exact:!0,path:"/",render:function(e){return r.a.createElement(A,Object.assign({},e,{wallet:n}))}}),r.a.createElement(l.b,{exact:!0,path:"/swap/:id",render:function(e){return r.a.createElement(O,Object.assign({},e,{wallet:n}))}})))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(S.a,null,r.a.createElement(R,null)),document.querySelector("#root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[29,1,2]]]);
//# sourceMappingURL=main.80da44c4.chunk.js.map